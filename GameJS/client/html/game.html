<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" style="background:#000000;">
<head id="Head1" runat="server">
    <title>JS Game</title>
    <link href="../styles/clsDisplayPanel.css" rel="stylesheet" />
    <link href="../styles/clsGround.css" rel="stylesheet" />
</head>
<body onkeydown="keyDownHandler(event)" ondrop="drop(event)" ondragover="allowDrop(event)">
    
</body>
</html>

<script src="../scripts/utils.js"></script>
<script src="../objects/clsVector2D.js"></script>
<script src="../objects/clsTileset.js"></script>
<script src="../objects/clsWorldView.js"></script>
<script src="../objects/clsDisplayPanel.js"></script>
<script src="../objects/clsGround.js"></script>

<script>
    // http://www.html5rocks.com/en/tutorials/dnd/basics/
    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
    }

    function drop(ev) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        ev.target.appendChild(document.getElementById(data));
    }
</script>


<script type="text/javascript">

    // data objects
    var world = {}
    world.player = new clsVector2D(0, 0);

    // display objects
    var playerPanel;
    
    // globals
    var heartBeat;

    function setup() {

        playerPanel = new clsWorldView(50, 50, 640, 480);
        // playerPanel2 = new clsWorldView(250, 250, 320, 200); testing only

        // this will have to do something at some point
        playerPanel.worldLocation = new clsVector2D(12, 0);
        
        // start game loop
        heartBeat = setInterval(function () { gameLoop(); }, 1000 / 10);
    }

    function gameLoop() {
        playerPanel.process();
    }

    function keyDownHandler(event) {

        //alert("event.keyCode" + event.keyCode);
        //alert("event.charCode" + event.charCode);

        switch (event.keyCode) {
            case 36:
                {
                    // up left
                    playerPanel.ground.shiftTiles(-1, -1);
                    break;
                }
            case 38:
                {
                    // up
                    playerPanel.ground.shiftTiles(0, -1);
                    break;
                }
            case 33:
                {
                    // up right
                    playerPanel.ground.shiftTiles(+1, -1);
                    break;
                }
            case 37:
                {
                    // left
                    playerPanel.ground.shiftTiles(-1, 0);
                    break;
                }
            case 39:
                {
                    // right
                    playerPanel.ground.shiftTiles(+1, 0);
                    break;
                }
            case 35:
                {
                    // down left
                    playerPanel.ground.shiftTiles(-1, +1);
                    break;
                }
            case 40:
                {
                    // down
                    playerPanel.ground.shiftTiles(0, +1);
                    break;
                }
            case 34:
                {
                    // down right
                    playerPanel.ground.shiftTiles(+1, +1);
                    break;
                }
            default:
                {
                    //alert("event.keyCode" + event.keyCode);
                }
        }
    }

    setup();
</script>

